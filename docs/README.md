# Poetry の --no-root オプションについて

`poetry install` コマンドには `--no-root` オプションがあります。

## 概要
`--no-root` オプションを付けることで、プロジェクト自身（ルートパッケージ）のインストールをスキップし、依存パッケージのみをインストールします。

## 使い方
```sh
poetry install --no-root
```

## どんな時に使う？
- プロジェクト自身のパッケージをインストールせず、依存パッケージだけをセットアップしたい場合
- テストやCI環境などで、ルートパッケージのインストールが不要な場合

## 注意点
- ルートパッケージのインストールが必要な場合は、`--no-root` を付けないでください。

---
Poetry公式ドキュメント: https://python-poetry.org/docs/cli/#install 

---

# Poetry の仮想環境をプロジェクト直下に作成する設定

`poetry config virtualenvs.in-project true` を実行すると、プロジェクトディレクトリ直下（今いる場所）に `.venv` ディレクトリが作成され、仮想環境がそこに配置されます。

## どういう時に使うの？

### 1. プロジェクトごとに仮想環境を明確に分けたい場合
- プロジェクトディレクトリ内に `.venv` ができるので、どの仮想環境がどのプロジェクト用か一目で分かります。
- 複数プロジェクトを扱う場合、グローバルな場所（例: `~/.cache/pypoetry/virtualenvs/`）に仮想環境が混在しません。

### 2. エディタやIDEとの連携が楽になる場合
- VSCodeやPyCharmなどは、プロジェクト直下の `.venv` を自動検出しやすいです。
- 設定ファイルを書き換えなくても、すぐに仮想環境を認識してくれます。

### 3. プロジェクトの移動や削除が簡単
- プロジェクトごとに仮想環境が閉じているので、ディレクトリごとコピー・削除しても他に影響しません。

### 4. CI/CDやDockerなどで一時的な環境を作る場合
- プロジェクト内で完結するため、クリーンな状態を保ちやすいです。

## 注意点
- `.venv` ディレクトリは通常 `.gitignore` に追加して、リポジトリに含めないようにします。
- ディスク容量を多く使う場合があるので、プロジェクト数が多いときは注意。

---

# Poetry で仮想環境を作成しない設定

`poetry config virtualenvs.create false` を実行すると、Poetryは仮想環境を新たに作成せず、**システムのPython環境に直接パッケージをインストール**します。

## どういう時に使うの？
- すでに仮想環境を自分で用意している場合（例: venv, conda など）
- DockerやCI環境など、隔離された環境でグローバルなPython環境を使いたい場合
- システム全体でパッケージを共有したい場合

## 注意点
- システムのPython環境を汚す可能性があるため、通常は推奨されません。
- 他のプロジェクトと依存関係が競合するリスクがあります。
- 必要な場合のみ利用し、基本はPoetryの仮想環境を使うのが安全です。

---
Poetry公式ドキュメント: https://python-poetry.org/docs/configuration/#virtualenvscreate 


# poetry.lock とは何か？

`poetry.lock` は、Poetry が **依存パッケージの正確なバージョンを固定・記録するファイル** です。  
npm の `package-lock.json` や pip の `requirements.txt` のような役割を果たします。

---

## なぜ必要？

### ✅ 再現性（Reproducibility）

`pyproject.toml` では柔軟なバージョン指定（例: `^7.0.0`）ができますが、それだと環境によって入るバージョンが変わってしまう可能性があります。  
一方で `poetry.lock` は **その時点で解決されたバージョンをピンポイントで固定**してくれるので、どの環境でも同じ挙動を保証できます。

> 例：  
> `pyproject.toml` → `pytest = "^7.0.0"`  
> `poetry.lock` → `pytest==7.0.1` と明示的にロック

---

### ✅ 依存の依存（transitive dependencies）も固定される

直接指定したパッケージだけでなく、それが依存しているパッケージ（transitive dependencies）のバージョンも `poetry.lock` に記録されます。

---

## 開発者としての使い方

| コマンド              | 目的                                     |
|-----------------------|------------------------------------------|
| `poetry install`      | `poetry.lock` に従って依存をインストール |
| `poetry lock`         | `pyproject.toml` に基づき lock を更新     |
| `poetry update`       | 依存パッケージを最新に更新しつつ lock も再作成 |

---

## `poetry.lock` を更新するケース

- `pyproject.toml` を編集（依存パッケージの追加/削除）
- Python のバージョンを変更した
- セキュリティ対応や機能追加のために依存をアップデートしたい

---

## Git でコミットすべき？

**Yes！**

`poetry.lock` は、**開発環境やCI/CD、本番環境における挙動の再現性を保証するため**に必ずコミットすべきです。

---

## まとめ

| 項目           | 内容                                                                 |
|----------------|----------------------------------------------------------------------|
| 用途           | 再現性ある環境構築                                                    |
| 管理対象       | 直接の依存 & 間接の依存                                                |
| コミット対象？ | **Yes（絶対にバージョン固定したいなら必須）**                        |
| 編集方法       | 基本は `poetry install` や `poetry update` で自動生成・更新される     |


poetry install と poetry.lock の関係
初めて依存をインストールする時（poetry.lock が存在しない状態）
→ pyproject.toml の依存情報を元に解決して依存バージョンを決め、
→ その解決結果が poetry.lock に書き込まれます。
→ 依存パッケージをインストールします。

すでに poetry.lock がある時
→ poetry.lock に書かれたバージョンに沿って依存パッケージをインストールします。